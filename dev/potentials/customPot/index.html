<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Custom Potentials · JMD.jl</title><meta name="title" content="Custom Potentials · JMD.jl"/><meta property="og:title" content="Custom Potentials · JMD.jl"/><meta property="twitter:title" content="Custom Potentials · JMD.jl"/><meta name="description" content="Documentation for JMD.jl."/><meta property="og:description" content="Documentation for JMD.jl."/><meta property="twitter:description" content="Documentation for JMD.jl."/><meta property="og:url" content="https://Cavenfish.github.io/JMD/potentials/customPot/"/><meta property="twitter:url" content="https://Cavenfish.github.io/JMD/potentials/customPot/"/><link rel="canonical" href="https://Cavenfish.github.io/JMD/potentials/customPot/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">JMD.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../bodies/">Bodies</a></li><li><a class="tocitem" href="../../optimizations/">Optimization</a></li><li><a class="tocitem" href="../../vibrations/">Vibrations</a></li><li><span class="tocitem">Molecular Dynamics</span><ul><li><a class="tocitem" href="../../md/dynamics/">Molecular Dynamics Simulations</a></li><li><a class="tocitem" href="../../md/thermostats/">Thermostats</a></li></ul></li><li><span class="tocitem">Potentials</span><ul><li><a class="tocitem" href="../potList/">Available Potentials</a></li><li class="is-active"><a class="tocitem" href>Custom Potentials</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Potentials</a></li><li class="is-active"><a href>Custom Potentials</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Custom Potentials</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Cavenfish/JMD" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Cavenfish/JMD/blob/main/docs/src/potentials/customPot.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Custom-Potentials"><a class="docs-heading-anchor" href="#Custom-Potentials">Custom Potentials</a><a id="Custom-Potentials-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Potentials" title="Permalink"></a></h1><p>Using a custom potential within <code>JMD.jl</code> is fairly straightforward. You need to make the following components.</p><ul><li><code>PotVars</code> struct</li><li>Initializer function (minimum 1, maximum 2)</li><li>Evaluation functions (minimum 1, maximum 3)</li></ul><h3 id="Potential-Variables-Struct"><a class="docs-heading-anchor" href="#Potential-Variables-Struct">Potential Variables Struct</a><a id="Potential-Variables-Struct-1"></a><a class="docs-heading-anchor-permalink" href="#Potential-Variables-Struct" title="Permalink"></a></h3><p>This struct should hold all parameters (outside of particle positions, velocities, etc.) needed to evaluate your potential. The name of this struct is not important but the type must be the <code>PotVars</code> type from <code>JMD</code>. </p><pre><code class="language-julia hljs">using JMD 

struct MyExamplePotVars{F&lt;:Float64} &lt;: JMD.PotVars
  gamma::F
end</code></pre><h3 id="Initializer-Function"><a class="docs-heading-anchor" href="#Initializer-Function">Initializer Function</a><a id="Initializer-Function-1"></a><a class="docs-heading-anchor-permalink" href="#Initializer-Function" title="Permalink"></a></h3><p>This function needs to initialize the variables used within your custom potential. The function should take a single parameter, either a vector of <code>Particle</code> or a <code>JMD cell</code> object, and return your custom <code>PotVars</code> struct initialized with your potential&#39;s parameters.</p><pre><code class="language-julia hljs">MyExamplePotential(x::Union{Vector{JMD.MyAtoms}, JMD.MyCell}) = MyExamplePotVars(16.0)</code></pre><h3 id="Evaluation-functions"><a class="docs-heading-anchor" href="#Evaluation-functions">Evaluation functions</a><a id="Evaluation-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Evaluation-functions" title="Permalink"></a></h3><p><code>JMD.jl</code> calculators can have 3 different evaluation functions: </p><ol><li>Energy only evaluation</li><li>Inplace forces only evaluation</li><li>Energy and inplace forces evaluation</li></ol><p>You don&#39;t need to make all 3 functions, but you must have both energy and force evaluations to make a full calculator. This means you can make just function number 3 or both functions 1 and 2. If you make all functions the calculator is given more flexibility which may increase performance. For instance, if you want to get the potential energy of your system and only function number 3 is available then the calculator will need to evaluate both forces and energy to return just the energy. Whereas, an energy only evaluation may be faster and more memory efficient.</p><p>The evaluation functions have required arguments and not adhereing to them will cause the calculator to not work. In the examples below they are shown, their names however are allowed to changed.</p><pre><code class="language-julia hljs">&quot;&quot;&quot;
Energy only evaluation

Required arguments:
  u: positions of particles in system
  vars: struct of variables passed to the calculator

Required return:
  energy: the energy of the system

Order must be preserved but u and vars can be named anything.
&quot;&quot;&quot;
function MyEnergy(u, vars)
  # Initialize energy
  E = 0.0

  # Access your PotVars from vars
  potVars = vars.potVars

  # Vars also has the masses and species of the system
  m = vars.m # masses
  s = vars.s # species (ie. &quot;H&quot; for hydrogen)

  # Iterate over all molecules in your system
  for mol in vars.mols
    E += potVars.gamma
  end

  # Iterate over all pairs in your system
  for par in vars.pars
    E -= 1.0
  end

  # Return the energy
  E
end

&quot;&quot;&quot;
Inplace forces only evaluation

Required arguments:
  F: forces on particles in system
  u: positions of particles in system
  vars: struct of variables passed to the calculator

No return value

Order must be preserved but u and vars can be named anything.
&quot;&quot;&quot;
function MyForces!(F, u, vars)
  # This exmaple just illustrates the declration of
  # this function.
  F .= 0.0
end

&quot;&quot;&quot;
Energy and inplace forces only evaluation

Required arguments:
  F: forces on particles in system
  u: positions of particles in system
  vars: struct of variables passed to the calculator

Required return:
  energy: the energy of the system

Order must be preserved but u and vars can be named anything.
&quot;&quot;&quot;
function MyEnergyAndForces!(F, u, vars)
  # You are allowed to do this
  E = MyEnergy(u, vars)
  MyForces!(F, u, vars)

  # Keep in mind though that if you need to iterate
  # over all mols and pars for both the forces and energy
  # doing this only once in here would be faster and more
  # memory efficient. Here we call the other two function 
  # just for the sake of showing you can do such a thing.

  # Return energy
  E
end</code></pre><h3 id="Putting-it-all-Together"><a class="docs-heading-anchor" href="#Putting-it-all-Together">Putting it all Together</a><a id="Putting-it-all-Together-1"></a><a class="docs-heading-anchor-permalink" href="#Putting-it-all-Together" title="Permalink"></a></h3><p>Now that we have made all the necessary components we can put it all together as a calculator.</p><pre><code class="language-julia hljs"># Define it as a variable
calc = Calculator(
  MyExamplePotential; 
  E = MyEnergy,
  F = MyForces!,
  EF = MyEnergyAndForces!
)

# Or define a grabber function for it
MyPotential() = Calculator(
  MyExamplePotential; 
  E = MyEnergy,
  F = MyForces!,
  EF = MyEnergyAndForces!
)

# You can then use either style
E = getPotEnergy(calc, bdys)
E = getPotEnergy(MyPotential(), bdys)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../potList/">« Available Potentials</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Thursday 26 June 2025 15:12">Thursday 26 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
